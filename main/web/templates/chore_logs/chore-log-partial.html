{% from "macros/key-val-list-item.html" import key_val_list_item %}

<div class="card mb-3 bg-dark chore-card" id="chore-log-card-{{ chore_log.chore_log_id }}">
    <div class="card-header d-flex">
        <h5 class="my-auto">
            <a href="{{ url_for("chores.edit", chore_id=chore_log.chore.chore_id) }}" class="chore-card-title-link">
                {{ chore_log.chore.title }}
            </a>
        </h5>
        {% include "chore_logs/chore-log-due-date-badge-partial.html" %}
    </div>

    <div class="card-body p-0">
        <div class="list-group list-group-flush">
            {% call key_val_list_item("Description") %}
                <p class="mb-1">
                    {% if chore_log.chore.description %}
                        {{ chore_log.chore.description }}
                    {% else %}
                        <i>No description.</i>
                    {% endif %}
                </p>
            {% endcall %}
            {% call key_val_list_item("Last Completed") %}
                <p class="mb-1">
                    {% if chore_log.previous %}
                        {{ chore_log.previous.completed_date.strftime("%A, %B %e, %l:%M%p") }}
                    {% else %}
                        <i>Never</i>
                    {% endif %}
                </p>
            {% endcall %}
            {% call key_val_list_item("Repeats") %}
                <p class="mb-1">
                    {% if chore_log.chore.repeat_type == 1 %}
                        Every {{ chore_log.chore.repeat_days }} days
                    {% elif chore_log.chore.repeat_type == 2 %}
                        Every {{ chore_log.chore.repeat_day_of_week|day_of_week_str }}
                    {% elif chore_log.chore.repeat_type == 3 %}

                        The {% if chore_log.chore.repeat_day_of_month == 31 %}last{% else %}{{ chore_log.chore.repeat_day_of_month|number_suffix }}{% endif %} day of every month
                    {% endif %}
                </p>
            {% endcall %}
            {% call key_val_list_item("Owner") %}
                <p class="mb-1">
                    {{ chore_log.chore.owner.name }}
                </p>
            {% endcall %}
            {# todo remove this #}
{#            {% call key_val_list_item("Exact Due Date") %}#}
{#                <p class="mb-1">#}
{#                    {{ chore_log.due_date.strftime("%a, %b %e %l:%M%p") }}#}
{#                </p>#}
{#            {% endcall %}#}
{#            {% call key_val_list_item("Chore Log ID") %}#}
{#                <p class="mb-1">#}
{#                    {{ chore_log.chore_log_id }}#}
{#                </p>#}
{#            {% endcall %}#}
            <div class="button-panel">
                {% if not chore_log.normal_next_due_date|extract_date < chore_log.due_date|extract_date %}
                    <button
                            title="Complete Now"
                            hx-post="{{ url_for("chore_logs.complete", chore_log_id=chore_log.chore_log_id) }}"
                            hx-target="#chore-log-card-{{ chore_log.chore_log_id }}"
                            hx-swap="outerHTML"
                            hx-confirm="Complete '{{ chore_log.chore.title }}' now?"
                    >
                        <span class="my-auto">
                            <span class="icon-check"></span>
                            &nbsp;
                            <span class="icon-action-redo"></span>
                            <br>
                            <span class="next-due-date">
                                Next: {{ chore_log.normal_next_due_date.strftime("%a, %m/%e") }}
    {#                            Next: {{ chore_log.normal_next_due_date.strftime("%a, %b %e %l:%M%p") }}#}
                            </span>
                        </span>
                    </button>
                {% endif %}
                {% if chore_log.normal_next_due_date != chore_log.stay_on_schedule_next_due_date %}
                    <button
                            title="Complete & Keep Schedule"
                            hx-post="{{ url_for("chore_logs.complete", chore_log_id=chore_log.chore_log_id, stay_on_schedule=True) }}"
                            hx-target="#chore-log-card-{{ chore_log.chore_log_id }}"
                            hx-swap="outerHTML"
                            hx-confirm="Complete '{{ chore_log.chore.title }}' and stay on schedule?"
                    >
                        <span class="my-auto">
                            <span class="icon-check"></span>
                            &nbsp;
                            <span class="icon-calendar"></span>
                            <br>
                            <span class="next-due-date">
                                Next: {{ chore_log.stay_on_schedule_next_due_date.strftime("%a, %m/%e") }}
    {#                            Next: {{ chore_log.stay_on_schedule_next_due_date.strftime("%a, %b %e %l:%M%p") }}#}
                            </span>
                        </span>
                    </button>
                {% endif %}
                <button
                        title="Undo Last Completion" {% if not chore_log.previous %}disabled{% endif %}
                        hx-post="{{ url_for("chore_logs.undo", chore_log_id=chore_log.chore_log_id) }}"
                        hx-target="#chore-log-card-{{ chore_log.chore_log_id }}"
                        hx-swap="outerHTML"
                        {% if chore_log.previous %}
                            hx-confirm="Undo completion of '{{ chore_log.chore.title }}' from {{ chore_log.previous.completed_date.strftime("%A, %B %e, %l:%M%p") }}?"
                        {% endif %}
                >
                    <span class="my-auto">
                        <span class="icon-action-undo"></span>
                        &nbsp;
                        <span class="icon-close"></span>
                        <br>
                        Undo
                    </span>
                </button>
            </div>
        </div>
    </div>
</div>